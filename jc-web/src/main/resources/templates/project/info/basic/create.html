<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/realaicy/css/s2/select2.min.css}"
      href="../../../../static/realaicy/css/s2/select2.min.css"/>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/realaicy/css/bootstrap-datepicker.css}"
      href="../../../../static/realaicy/css/bootstrap-datepicker.css"/>



<div class="row" xmlns:th="http://www.thymeleaf.org">
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h1 class="page-title txt-color-blueDark"><i class="fa fa-pencil-square-o fa-fw "></i> 项目管理 <span>>
			新建项目 </span></h1>
    </div>
    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
    </div>
</div>

<!-- widget grid -->
<section id="widget-grid" class="">

    <!-- row -->
    <div class="row">

        <!-- NEW WIDGET START -->
        <article class="col-sm-12 col-md-12 col-lg-12">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget jarviswidget-color-darken" id="wid-id-0" data-widget-editbutton="false"
                 data-widget-deletebutton="false">
                <!-- widget options:
                usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

                data-widget-colorbutton="false"
                data-widget-editbutton="false"
                data-widget-togglebutton="false"
                data-widget-deletebutton="false"
                data-widget-fullscreenbutton="false"
                data-widget-custombutton="false"
                data-widget-collapsed="true"
                data-widget-sortable="false"

                -->
                <header>
                    <span class="widget-icon"> <i class="fa fa-check"></i> </span>
                    <h2>新建稽查项目</h2>

                </header>

                <!-- widget div-->
                <div>

                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->

                    </div>
                    <!-- end widget edit box -->

                    <!-- widget content -->
                    <div class="widget-body">

                        <div class="row">
                            <!--/*@thymesVar id="realmodel" type=""*/-->
                            <form novalidate="novalidate" th:object="${realmodel}" method="POST"
                                  th:action="@{/project/infor/basic/save}"
                                  id="realentity" xmlns:th="http://www.thymeleaf.org">
                                <div id="bootstrap-wizard-1" class="col-sm-12">
                                    <div class="form-bootstrapWizard">
                                        <ul class="bootstrapWizard form-wizard">
                                            <li class="active" data-target="#step1">
                                                <a href="#tab1" data-toggle="tab"> <span class="step">1</span> <span
                                                        class="title">录入项目基本信息</span> </a>
                                            </li>
                                            <li data-target="#step2">
                                                <a href="#tab2" data-toggle="tab"> <span class="step">2</span> <span
                                                        class="title">配置项目稽查流程</span> </a>
                                            </li>
                                            <li data-target="#step3">
                                                <a href="#tab3" data-toggle="tab"> <span class="step">3</span> <span
                                                        class="title">分配项目角色及人员</span> </a>
                                            </li>
                                            <li data-target="#step4">
                                                <a href="#tab4" data-toggle="tab"> <span class="step">4</span> <span
                                                        class="title">选择稽查数据库</span> </a>
                                            </li>
                                            <li data-target="#step5">
                                                <a href="#tab5" data-toggle="tab"> <span class="step">5</span> <span
                                                        class="title">保存项目</span> </a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="tab1">
                                            <br>
                                            <br>
                                            <br>
                                            <h4><strong>Step 1 </strong> - 项目基本信息</h4>
                                            <br>
                                            <fieldset>

                                                <div class="row">
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label"
                                                                   style="padding-top: 6px">项目名称：</label>
                                                            <div class="col-md-10">
                                                                <input class="form-control" name="pjName"
                                                                       th:field="*{pjName}"
                                                                       placeholder="项目名称" type="text"
                                                                       data-rule-required="true"
                                                                       data-msg-required="项目名称">
                                                            </div>
                                                            <input id="updateflag" name="updateflag" type="hidden" th:value="${realneworupdate}">

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label"
                                                                   style="padding-top: 6px">项目预算：</label>
                                                            <div class="col-md-10">
                                                                <input class="form-control"
                                                                       placeholder="项目预算" type="text" name="budget"
                                                                       th:field="*{budget}"
                                                                       data-rule-required="true"
                                                                       data-msg-required="项目预算">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label"
                                                                   style="text-align: left ;padding-top: 6px">请选择项目经理：</label>

                                                            <div class="col-md-10">
                                                                <select  name="managerID" th:field="*{managerID}" id="managerID" style="width: 50%;">

                                                                </select>
                                                            </div>


                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <label>请选择项目生命周期起止时间:</label>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <div class="input-group">
                                                                <input type="text" name="pjStartDate" id="pjStartDate"  th:field="*{pjStartDate}" placeholder="开始时间"
                                                                       class="form-control">
                                                                <span class="input-group-addon"><i
                                                                        class="fa fa-calendar"></i></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <div class="input-group">
                                                                <input type="text" name="pjDeadlineDate"  id="pjDeadlineDate"  th:field="*{pjDeadlineDate}" placeholder="结束时间"
                                                                       class="form-control"
                                                                       >
                                                                <span class="input-group-addon"><i
                                                                        class="fa fa-calendar"></i></span>
                                                            </div>
                                                        </div>

                                                    </div>

                                                </div>


                                            </fieldset>

                                        </div>
                                        <div class="tab-pane" id="tab2">
                                            <br>
                                            <br>
                                            <br>
                                            <h4><strong>Step 2 </strong> - 配置稽查流程</h4>
                                            <br>
                                            <fieldset>

                                                <div class="row">
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <img th:src="@{/realimages/process/temp/a1.png}"
                                                             src="../../static/realimages/process/temp/a1.png" alt="me"
                                                             class="online"/>

                                                    </div>
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <img th:src="@{/realimages/process/temp/a2.png}"
                                                             src="../../static/realimages/process/temp/a2.png" alt="me"
                                                             class="online"/>

                                                    </div>


                                                </div>

                                            </fieldset>
                                        </div>
                                        <div class="tab-pane" id="tab3">
                                            <br>
                                            <br>
                                            <br>
                                            <h4><strong>Step 3 </strong> - 分配项目角色及人员</h4>
                                            <br>
                                            <fieldset>
                                                <legend style="font-size: 14px">请从人才库中为此项目分配预稽查人员</legend>
                                                <div class="row">
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label"
                                                                   style="text-align: left ;padding-top: 6px">预稽查工作组：</label>
                                                            <div class="col-md-10">
                                                                <select multiple style="width:100%" class="select2">
                                                                    <optgroup label="肿瘤科">
                                                                        <option value="AK">预稽查员1</option>
                                                                        <option value="HI">预稽查员2</option>
                                                                        <option value="lb">预稽查员3</option>

                                                                    </optgroup>
                                                                    <optgroup label="脑科">
                                                                        <option value="CA">预稽查员4</option>
                                                                        </option>
                                                                        <option value="OR">预稽查员5</option>
                                                                        <option value="WA">预稽查员6</option>
                                                                    </optgroup>
                                                                    <optgroup label="心脏科">
                                                                        <option value="AZ">Arizona</option>
                                                                        <option value="CO">Colorado</option>
                                                                        <option value="ID">Idaho</option>
                                                                        </option>
                                                                        <option value="NE">Nebraska</option>
                                                                        <option value="NM">New Mexico</option>
                                                                        <option value="ND">North Dakota</option>
                                                                        <option value="UT">Utah</option>
                                                                        <option value="WY">Wyoming</option>
                                                                    </optgroup>

                                                                </select>


                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                            <fieldset>
                                                <legend style="font-size: 14px">请从专家库中为此项目分配稽查人员</legend>
                                                <div class="row">
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label"
                                                                   style="text-align: left ;padding-top: 6px">稽查工作组：</label>
                                                            <div class="col-md-10">
                                                                <select multiple style="width:100%" class="select2">
                                                                    <optgroup label="肿瘤科">
                                                                        <option value="AK">肿瘤稽查员1</option>
                                                                        <option value="HI">肿瘤稽查员2</option>
                                                                        <option value="lb">肿瘤稽查员3</option>

                                                                    </optgroup>
                                                                    <optgroup label="脑科">
                                                                        <option value="CA">肿瘤稽查员4</option>
                                                                        </option>
                                                                        <option value="OR">肿瘤稽查员5</option>
                                                                        <option value="WA">肿瘤稽查员6</option>
                                                                    </optgroup>
                                                                    <optgroup label="心脏科">
                                                                        <option value="AZ">Arizona</option>
                                                                        <option value="CO">Colorado</option>
                                                                        <option value="ID">Idaho</option>
                                                                        </option>
                                                                        <option value="NE">Nebraska</option>
                                                                        <option value="NM">New Mexico</option>
                                                                        <option value="ND">North Dakota</option>
                                                                        <option value="UT">Utah</option>
                                                                        <option value="WY">Wyoming</option>
                                                                    </optgroup>
                                                                    <optgroup label="特聘稽查员">
                                                                        <option value="boss" selected="selected">王雨萌
                                                                        </option>
                                                                    </optgroup>
                                                                </select>


                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                            <fieldset>
                                                <legend style="font-size: 14px">请从专家库中为此项目分配专家</legend>
                                                <div class="row">
                                                    <div class="col-sm-12" style="margin-bottom: 10px">
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label"
                                                                   style="text-align: left ;padding-top: 6px">专家组：</label>
                                                            <div class="col-md-10">
                                                                <select multiple style="width:100%" class="select2">
                                                                    <optgroup label="肿瘤科">
                                                                        <option value="AK">肿瘤专家1</option>
                                                                        <option value="HI">肿瘤专家2</option>
                                                                        <option value="lb">刘备</option>

                                                                    </optgroup>
                                                                    <optgroup label="脑科">
                                                                        <option value="CA">脑科专家1</option>
                                                                        </option>
                                                                        <option value="OR">脑科专家2</option>
                                                                        <option value="WA">脑科专家3</option>
                                                                    </optgroup>
                                                                    <optgroup label="心脏科">
                                                                        <option value="AZ">Arizona</option>
                                                                        <option value="CO">Colorado</option>
                                                                        <option value="ID">Idaho</option>
                                                                        </option>
                                                                        <option value="NE">Nebraska</option>
                                                                        <option value="NM">New Mexico</option>
                                                                        <option value="ND">North Dakota</option>
                                                                        <option value="UT">Utah</option>
                                                                        <option value="WY">Wyoming</option>
                                                                    </optgroup>
                                                                    <optgroup label="特聘专家">
                                                                        <option value="boss" selected="selected">闫主任
                                                                        </option>
                                                                    </optgroup>
                                                                </select>


                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                        </div>
                                        <div class="tab-pane" id="tab4">
                                            <br>
                                            <br>
                                            <br>
                                            <h4><strong>Step 4</strong> - 选择稽查项数据库</h4>
                                            <div class="row">
                                                <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

                                                    <!-- Widget ID (each widget will need unique ID)-->
                                                    <div class="jarviswidget" id="wid-id-1">

                                                        <header>
                                                        <span class="widget-icon"> <i
                                                                class="fa fa-comments"></i> </span>
                                                            <h2>稽查项树形列表</h2>

                                                        </header>

                                                        <!-- widget div-->
                                                        <div>

                                                            <!-- widget edit box -->
                                                            <div class="jarviswidget-editbox">
                                                                <!-- This area used as dropdown edit box -->
                                                            </div>
                                                            <!-- end widget edit box -->

                                                            <!-- widget content -->
                                                            <div class="widget-body">

                                                                <div class="row">
                                                                    <div class="col-sm-12">

                                                                    </div>
                                                                </div>

                                                                <div class="row">
                                                                    <div class="col-sm-12">
                                                                        <!-- Add a <table> element where the tree should appear: -->
                                                                        <table id="treetable"
                                                                               class="table table-striped table-bordered table-hover">
                                                                            <colgroup>
                                                                                <col width="30px"/>
                                                                                <col width="30px"/>
                                                                                <col width="*"/>
                                                                                <col width="50px"/>
                                                                            </colgroup>
                                                                            <thead>
                                                                            <tr>
                                                                                <th></th>
                                                                                <th>#</th>
                                                                                <th>稽查项名称</th>
                                                                                <th>所查文件</th>
                                                                            </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                            </tbody>
                                                                        </table>
                                                                        <!-- (Irrelevant source removed.) -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- end widget content -->
                                                        </div>
                                                        <!-- end widget div -->
                                                    </div>
                                                    <!-- end widget -->
                                                </article>
                                            </div>


                                        </div>
                                        <div class="tab-pane" id="tab5">
                                            <br>
                                            <br>
                                            <br>
                                            <h4><strong>Step 5</strong> - 确认保存</h4>
                                            <br>
                                            <fieldset style="padding-top: 2px">
                                                <section class="col col-6" align="left" style="padding-top: 6px">
                                                    <button type="reset" class="btn btn-primary"
                                                            style="height: 32px;width: 80px;font-size: 13px;margin-right: 20px">
                                                        重置数据
                                                    </button>
                                                   <!-- <button type="submit" class="btn btn-primary"
                                                            style="height: 32px;width: 80px">
                                                        提交数据
                                                    </button>-->
                                                    <button data-loading-text="&lt;i class='fa fa-refresh fa-spin'&gt;&lt;/i&gt; &nbsp; 努力创建中..." class="btn btn-primary" type="submit" id="btnsave">
                                                        创建项目 <i class="fa fa-arrow-circle-right fa-lg"></i>
                                                    </button>
                                                </section>
                                            </fieldset>
                                            <br>
                                            <br>
                                        </div>

                                        <div class="form-actions">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <ul class="pager wizard no-margin">
                                                        <!--<li class="previous first disabled">
                                                        <a href="javascript:void(0);" class="btn btn-lg btn-default"> First </a>
                                                        </li>-->
                                                        <li class="previous disabled">
                                                            <a href="javascript:void(0);"
                                                               class="btn btn-lg btn-default"> Previous </a>
                                                        </li>
                                                        <li>
                                                            <section class="col col-6">
                                                                <span id="realerrormsg"></span>
                                                            </section>
                                                        </li>
                                                        <!--<li class="next last">
                                                        <a href="javascript:void(0);" class="btn btn-lg btn-primary"> Last </a>
                                                        </li>-->
                                                        <li class="next">
                                                            <a href="javascript:void(0);"
                                                               class="btn btn-lg txt-color-darken" id="realnext">
                                                                Next </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>


                    </div>
                    <!-- end widget content -->

                </div>
                <!-- end widget div -->

            </div>
        </article>
        <!-- end widget -->
        <!-- WIDGET END -->


    </div>

    <!-- end row -->
</section>
<!-- end widget grid -->

<script type="text/javascript">

    var reals2data;

    pageSetUp();

    var pagefunction = function () {

        $('#pjStartDate').datepicker({
            dateFormat: 'yy-mm-dd'
        });
        $('#pjDeadlineDate').datepicker({

            dateFormat: 'yy-mm-dd'
        });




        loadScript("realaicy/js/s2/select2.full.min.js", runs2);

        function runs2() {

            $("#managerID").select2({
                data:reals2data
            });
        }

        loadScript("smartadmin/js/plugin/bootstrap-wizard/jquery.bootstrap.wizard.min.js", runBootstrapWizard);

        function runBootstrapWizard() {

            var $validator = $("#realentity").validate({
                invalidHandler: function (event, validator) {
                    var errors = validator.numberOfInvalids();
                    if (errors) {
                        var message = errors == 1
                                ? 'You missed 1 field. It has been highlighted'
                                : 'You missed ' + errors + ' fields. They have been highlighted';
                        $("#realerrormsg").html(message);
                    } else {
                        $("div.error").hide();
                    }
                },
                errorLabelContainer: "#realerrormsg",
                //wrapper: "li",
                highlight: function (element) {
                    $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
                },
                unhighlight: function (element) {
                    $(element).closest('.form-group').removeClass('has-error').addClass('has-success');
                },
                errorElement: 'span',
                errorClass: 'help-block',
                wrapper: "li",
                errorPlacement: function (error, element) {
                    if (element.parent('.input-group').length) {
                        error.insertAfter(element.parent());
                    } else {
                        error.insertAfter(element);
                    }
                },
                rules: {
                    pjName: {
                        required: true
                    },
                    budget: {
                        required: true
                    }
                },
                messages: {
                    username: {
                        required: '请输入项目名称'
                    },
                    budget: {
                        required: '请输入项目预算'
                    }
                },
                submitHandler: function (form) {
                    if ($("#updateflag").val() == "new") {
                        $.ajax({
                            url: form.action,
                            type: form.method,
                            data: $(form).serialize(),
                            success: function (response) {
                                if (response == "ok") {
                                    real_g_success("创建项目成功！");

                                    // wait for animation to finish and execute send script
                                    setTimeout(function (){
                                        loadURL("dashboard/dashboard.html", $('#content'))
                                    }, 1000); // how long do you want the delay to be?
                                }
                                else {
                                    real_g_fail(response);
                                }
                            }
                        });
                    } else {
                        $("#updateflag").attr("value", 'editedit');
                        $.ajax({
                            url: form.action,
                            type: form.method,
                            data: $(form).serialize(),
                            success: function (response) {
                                if (response == "ok") {
                                    real_g_success("修改用户成功！");
                                } else {
                                    real_g_fail(response);
                                }
                            }
                        });
                    }
                }
            });


            $('#bootstrap-wizard-1').bootstrapWizard({

                'tabClass': 'form-wizard',
                'onNext': function (tab, navigation, index) {
                    if (index == 4) {
                        $('#realnext').attr('disabled', "true");
                        $('#realnext').removeAttr('onclick');//去掉a标签中的href属性
                    }
                    var $valid = $("#realentity").valid();
                    if (!$valid) {
                        $validator.focusInvalid();
                        return false;
                    } else {
                        $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).addClass('complete');
                        $('bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).find('.step').html('<i class="fa fa-check"></i>');
                        console.log("ok " + index)
                    }
                }
            });
        }
    };

    $.ajax({
        url:'/project/infor/basic/m3',
        type:'GET', //GET
        async:true,    //或false,是否异步
        data:{
            name:'yang',age:25
        },
        timeout:5000,    //超时时间
        dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
        beforeSend:function(xhr){
        },
        success:function(data,textStatus,jqXHR){
            console.log("data:"+data);
            console.log("data222:"+data.items);

            reals2data = data.items;
        },
        error:function(xhr,textStatus){
        },
        complete:function(){
            pagefunction();
        }
    })

</script>
