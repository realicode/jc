<title>组织机构</title>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/realaicy/css/fancytree/ui.fancytree.css}"
      href="../../../static/realaicy/css/fancytree/ui.fancytree.css"/>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/smartadmin/css/realaicy.css}"
      href="../../../static/smartadmin/css/realaicy.css"/>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/realaicy/css/bootstrap-dialog.min.css}"
      href="../../../static/realaicy/css/bootstrap-dialog.min.css"/>
<!-- row -->
<div class="row">
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h2 class="page-title txt-color-blueDark">
            <i class="fa-fw fa fa-home"></i>
            系统管理
            <span>>
				组织机构管理
			</span>
        </h2>
    </div>
    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
        <ul id="sparks">
            <li class="sparks-info">
                <h6> 系统机构总数 <span class="txt-color-blue"><i class="fa fa-folder-open"
                                                            data-rel="bootstrap-tooltip" title="Increased"></i>&nbsp;&nbsp;11</span>
                </h6>
            </li>
            <li class="sparks-info">
                <h6> 我的机构总数 <span class="txt-color-purple"><i class="fa fa-arrow-circle-up"
                                                              data-rel="bootstrap-tooltip" title="Increased"></i>&nbsp;45%</span>
                </h6>
            </li>
            <li class="sparks-info">
                <h6> XXX <span class="txt-color-greenDark"><i class="fa fa-file-text-o"></i>&nbsp;1668(fake)</span>
                </h6>
            </li>
        </ul>
    </div>
</div>
<section id="widget-grid" class="">
    <div class="alert alert-success  collapse alert-dismissible" role="alert" id="realalert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                aria-hidden="true">&times;</span></button>
        <strong>操作成功!</strong> <span id="realalertinfo"></span>
    </div>

    <div class="row">
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget jarviswidget-color-darken widget-realaicy" id="real_entity"
                 data-widget-editbutton="false"
                 data-widget-collapsed="true"
                 data-widget-deletebutton="false"
                 data-widget-fullscreenbutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>新增 || 修改 组织机构 —— 控制面板</h2>
                </header>
                <div id="realeditdiv">

                </div>
            </div>
        </article>
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget jarviswidget-color-darken widget-realaicy" id="real_treesearch"
                 data-widget-editbutton="false"
                 data-widget-collapsed="true"
                 data-widget-deletebutton="false"
                 data-widget-fullscreenbutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>查询组织机构</h2>
                </header>
                <div>
                    <div class="jarviswidget-editbox">
                    </div>
                    <div class="widget-body">
                        <form class="form-horizontal">
                            <fieldset>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">组织机构名称</label>
                                    <div class="col-md-10">
                                        <input class="form-control" name="searchname" placeholder="组织机构名称" type="text">
                                    </div>
                                </div>
                            </fieldset>
                            <footer>
                                <a href="javascript:void(0);" id="btnSearch2"
                                   class="btn btn-labeled btn-primary"> <span
                                        class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>查询组织机构
                                </a>
                            </footer>
                        </form>


                        <div class="row">
                            <div class="col-sm-12">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget" id="wid-id-1">
                <header>
                    <span class="widget-icon"> <i class="fa fa-comments"></i> </span>
                    <h2>组织结构树</h2>
                </header>
                <div>
                    <div class="jarviswidget-editbox">
                    </div>
                    <div class="widget-body">
                        <div class="row">
                            <div class="col-sm-12">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <table id="treetable" class="table table-striped table-bordered table-hover">
                                    <colgroup>
                                        <col width="30px"/>
                                        <col width="30px"/>
                                        <col width="*"/>
                                        <col width="50px"/>
                                        <col width="60px"/>
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th></th>
                                        <th>#</th>
                                        <th>组织机构名称</th>
                                        <th>联系人</th>
                                        <th>联系电话</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
    </div>
    <div class="row">
        <div class="alert alert-success fade in">

            <i class="fa-fw fa fa-check"></i>
            <strong style="font-size:13px">当前选定的组织机构 &nbsp: &nbsp &nbsp</strong>
            <span id="nowid"></span>
        </div>
    </div>
    <div class="row">
        <form id="realForm" method="post" class="form-horizontal">
            <div class="col-sm-3">
                <div class="input-group">
                    <div class="input-group-btn">
                        <a href="javascript:void(0);" id="btnModify"
                           class="btn btn-labeled btn-primary"> <span
                                class="btn-label"><i class="fa fa-pencil"></i></span>机构信息编辑 </a>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="input-group">
                    <div class="input-group-btn">
                        <a href="javascript:void(0);" id="btnSubNew"
                           class="btn btn-labeled btn-info"> <span
                                class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>新建下级组织机构
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="input-group">
                    <div class="input-group-btn">
                        <a href="javascript:void(0);" id="btnSearch"
                           class="btn btn-labeled btn-primary"> <span
                                class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>查询组织机构
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <a href="javascript:void(0);" id="btnDel" class="btn btn-labeled btn-danger"> <span
                        class="btn-label"><i class="glyphicon glyphicon-remove"></i></span>删除当前组织机构
                </a>
            </div>
        </form>
    </div>
    <div class="row">
        <div class="col-sm-12">
        </div>
    </div>

</section>
<script type="text/javascript">
    pageSetUp();
//    function realModifyName() {
//        console.log("realModifyName");
//        console.log($("#echoActive2").val());
//        var node = $("#tree2").fancytree("getActiveNode");
//        console.log("待更新的原始数据： " + node.data.id + node.title);
//        $.ajax({
//            url: "/doccenter/catalog/edit",
//            async: true,
//            data: {id: node.data.id, title: $("#echoActive2").val()},
//            type: "GET",
//            success: function (data) {
//                console.log("success");
//                $("#tree2").fancytree("getTree").reload();
//                console.log("success2222");
//            }
//        });
//        console.log("End");
//    }

    var pagefunction = function () {

        var realmsg = "请先选择一个节点";

        $("#treetable").fancytree({
            extensions: ["table", "filter"],
            checkbox: true,
            table: {
                indentation: 20,
                nodeColumnIdx: 2,
                checkboxColumnIdx: 0
            },
            filter: {
                counter: true, // Show a badge with number of matching child nodes near parent icons
                hideExpandedCounter: true, // Hide counter badge, when parent is expanded
                mode: "dimm"  // "dimm": Grayo
            },
            source: {
                url: "/system/org/list",
                cache: false
            },
            renderColumns: function (event, data) {
                var node = data.node,
                        $tdList = $(node.tr).find(">td");
                $tdList.eq(1).text(node.getIndexHier()).addClass("alignRight");
                $tdList.eq(3).text(node.data.contactName);
                $tdList.eq(4).text(node.data.contactTel);
            },
            activate: function (event, data) {
                var node = data.node;
                $("#nowid").text(node.title);
            }
        });

        $("#btnSearch").click(function () {

            $("#realeditdiv").load("/system/org/new?pid=" + node.data.id + "&pname=" + encodeURIComponent(node.title));
            if ($("#real_entity").hasClass("jarviswidget-collapsed"))
                $("#real_entity a.jarviswidget-toggle-btn").trigger("click");
        });

        $("#btnSearch2").click(function () {

            $("#treetable").fancytree("getTree").filterNodes($("input[name=searchname]").val(), {
                autoExpand: true,
                leavesOnly: true
            });

        });

        $("#btnSubNew").click(function () {
            console.log("realCreateSubOrg");
            var node = $("#treetable").fancytree("getActiveNode");
            if (node == null || node == undefined || node == '') {
                BootstrapDialog.alert({
                    title: '系统提示信息：',
                    message: realmsg,
                    type: BootstrapDialog.TYPE_DANGER, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
                    closable: true, // <-- Default value is false
                    buttonLabel: '确定', // <-- Default value is 'OK',
                    callback: function (result) {
                    }
                });
            } else {
                $("#realeditdiv").load("/system/org/new?pid=" + node.data.id + "&pname=" + encodeURIComponent(node.title));

                if ($("#real_entity").hasClass("jarviswidget-collapsed"))
                    $("#real_entity a.jarviswidget-toggle-btn").trigger("click");
            }

        });

        $("#btnModify").click(function () {
            var node = $("#treetable").fancytree("getActiveNode");
            if (node == null || node == undefined || node == '') {
                BootstrapDialog.alert({
                    title: '系统提示信息：',
                    message: realmsg,
                    type: BootstrapDialog.TYPE_DANGER, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
                    closable: true, // <-- Default value is false
                    buttonLabel: '确定', // <-- Default value is 'OK',
                    callback: function (result) {
                    }
                });
            } else {
                $("#realeditdiv").load("/system/org/show/" + node.data.id);
                if ($("#real_entity").hasClass("jarviswidget-collapsed"))
                    $("#real_entity a.jarviswidget-toggle-btn").trigger("click");
            }
        });
        $("#btnDel").click(function () {
            var node = $("#treetable").fancytree("getActiveNode");
            if (node == null || node == undefined || node == '') {
                BootstrapDialog.alert({
                    title: '系统提示信息：',
                    message: realmsg,
                    type: BootstrapDialog.TYPE_DANGER, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
                    closable: true, // <-- Default value is false
                    buttonLabel: '确定', // <-- Default value is 'OK',
                    callback: function (result) {
                    }
                });
            } else {
                console.log("deldel");

                BootstrapDialog.show({
                    title: '系统提示信息',
                    message: '请确认是否删除选定数据.',
                    buttons: [{
                        label: '确认删除',
                        action: function (dialog) {
                            dialog.close()
                            $("#updateflag").attr("value", 'deldel');
                            $.ajax({
                                url: '/system/org/del/' + node.data.id,
                                type: 'GET',
                                success: function (response) {
                                    if (response.substring(0, 2) == "ok") {
                                        $('#realalertinfo').text('——删除组织机构成功！');
                                        $('#realalert').fadeTo(2000, 500).delay(5000).slideUp(500, function () {
                                            //$("#realtemp_a").delay().slideUp(500);
                                        });
                                        $.smallBox({
                                            title: "删除组织机构成功",
                                            content: "<i class='fa fa-clock-o'></i> <i>2 seconds ago...</i>",
                                            color: "#296191",
                                            iconSmall: "fa fa-thumbs-up bounce animated",
                                            timeout: 4000
                                        });
                                    }

                                    else {
                                        $.SmartMessageBox({
                                            title: "出错了!",
                                            content: response,
                                            buttons: '[确定]'
                                        })
                                    }
                                    $("#treetable").fancytree("getTree").reload();
                                }
                            });
                        }
                    }, {
                        label: '取消',
                        action: function (dialogItself) {
                            dialogItself.close();
                        }
                    }]
                });
            }
        });
    };
    loadScript("realaicy/js/fancytree/jquery.fancytree-all.js", function () {
        loadScript("realaicy/js/bootstrap-dialog.min.js", pagefunction);
    });

</script>
