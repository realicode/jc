<!-- Bread crumb is created dynamically -->
<!-- Include Fancytree skin and library -->
<title>组织机构</title>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/realaicy/css/fancytree/ui.fancytree.css}"
      href="../../../static/realaicy/css/fancytree/ui.fancytree.css"/>

<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/smartadmin/css/realaicy.css}"
      href="../../../static/smartadmin/css/realaicy.css"/>
<!-- row -->
<div class="row">

    <!-- col -->
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h2 class="page-title txt-color-blueDark">

            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-home"></i>
            系统管理
            <span>>
				组织机构管理
			</span>
        </h2>
    </div>
    <!-- end col -->

    <!-- right side of the page with the sparkline graphs -->
    <!-- col -->
    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
        <!-- sparks -->
        <ul id="sparks">
            <li class="sparks-info">
                <h6> 当前目录总数 <span class="txt-color-blue"><i class="fa fa-folder-open"
                                                            data-rel="bootstrap-tooltip" title="Increased"></i>&nbsp;&nbsp;11</span>
                </h6>
                <div class="sparkline txt-color-blue hidden-mobile hidden-md hidden-sm">
                    1300, 1877, 2500, 2577, 2000, 2100, 3000, 2700, 3631, 2471, 2700, 3631, 2471
                </div>
            </li>
            <li class="sparks-info">
                <h6> 文档增长趋势 <span class="txt-color-purple"><i class="fa fa-arrow-circle-up"
                                                              data-rel="bootstrap-tooltip" title="Increased"></i>&nbsp;45%</span>
                </h6>
                <div class="sparkline txt-color-purple hidden-mobile hidden-md hidden-sm">
                    110,150,300,130,400,240,220,310,220,300, 270, 210
                </div>
            </li>
            <li class="sparks-info">
                <h6> 当前文件总数 <span class="txt-color-greenDark"><i class="fa fa-file-text-o"></i>&nbsp;1668(fake)</span>
                </h6>
                <div class="sparkline txt-color-greenDark hidden-mobile hidden-md hidden-sm">
                    110,150,300,130,400,240,220,310,220,300, 270, 210
                </div>
            </li>
        </ul>
        <!-- end sparks -->
    </div>
    <!-- end col -->

</div>
<!-- end row -->

<!--
	The ID "widget-grid" will start to initialize all widgets below 
	You do not need to use widgets if you dont want to. Simply remove 
	the <section></section> and you can use wells or panels instead 
	-->

<!-- widget grid -->
<section id="widget-grid" class="">

    <!-- row -->
    <div class="row">

        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <!-- Widget ID (each widget will need unique ID)-->
            <div
                    class="jarviswidget jarviswidget-color-darken widget-realaicy" id="real_entity"
                    data-widget-editbutton="false"
                    data-widget-collapsed="true"
                    data-widget-deletebutton="false"
                    data-widget-fullscreenbutton="false">

                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>新增 || 修改 || 查询组织机构 —— 控制面板</h2>
                </header>

                <!-- widget div-->
                <div id="realeditdiv">

                </div>
                <!-- end widget div -->

            </div>
            <!-- end widget -->

        </article>
        <!-- WIDGET END -->

        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-1">

                <header>
                    <span class="widget-icon"> <i class="fa fa-comments"></i> </span>
                    <h2>组织结构树</h2>

                </header>

                <!-- widget div-->
                <div>

                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                    </div>
                    <!-- end widget edit box -->

                    <!-- widget content -->
                    <div class="widget-body">

                        <div class="row">
                            <div class="col-sm-12">

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12">
                                <!-- Add a <table> element where the tree should appear: -->
                                <table id="treetable" class="table table-striped table-bordered table-hover">
                                    <colgroup>
                                        <col width="30px"/>
                                        <col width="30px"/>
                                        <col width="*"/>
                                        <col width="50px"/>
                                        <col width="60px"/>
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th></th>
                                        <th>#</th>
                                        <th>组织机构名称</th>
                                        <th>联系人</th>
                                        <th>联系电话</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                                <!-- (Irrelevant source removed.) -->
                            </div>
                        </div>
                    </div>
                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
            </div>
            <!-- end widget -->
        </article>
        <!-- WIDGET END -->
    </div>

    <!-- end row -->

    <!-- row -->
    <div class="row">
        <div class="alert alert-success fade in">

            <i class="fa-fw fa fa-check"></i>
            <strong style="font-size:13px">当前选定的组织机构 &nbsp: &nbsp &nbsp</strong>
            <span id="nowid"></span>
        </div>
    </div>

    <div class="row">
        <form id="realForm" method="post" class="form-horizontal">

            <div class="col-sm-3">
                <div class="input-group">
                    <div class="input-group-btn">
                        <a href="javascript:void(0);" id="btnModify"
                           class="btn btn-labeled btn-primary"> <span
                                class="btn-label"><i class="fa fa-pencil"></i></span>修改机构名称 </a>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                <div class="input-group">
                    <div class="input-group-btn">
                        <a href="javascript:void(0);" id="btnSubNew"
                           class="btn btn-labeled btn-info"> <span
                                class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>新建下级组织机构
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="input-group">
                    <div class="input-group-btn">
                        <a href="javascript:void(0);" id="btnNew"
                           class="btn btn-labeled btn-primary"> <span
                                class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>新增顶级组织机构
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <a href="javascript:void(0);" class="btn btn-labeled btn-danger"> <span
                        class="btn-label"><i class="glyphicon glyphicon-remove"></i></span>删除当前组织机构
                </a>

            </div>
        </form>
    </div>


    <div class="row">

        <!-- a blank row to get started -->
        <div class="col-sm-12">
            <!--<div>当前选择节点: <span id="echoActive">-</span></div>-->


        </div>

    </div>

    <!-- end row -->

</section>
<!-- end widget grid -->

<script type="text/javascript">


    pageSetUp();
    // pagefunction
    function realModifyName() {
        console.log("realModifyName");
        console.log($("#echoActive2").val());
        var node = $("#tree2").fancytree("getActiveNode");
        console.log("待更新的原始数据： " + node.data.id + node.title);
        $.ajax({
            url: "/doccenter/catalog/edit",    //请求的url地址
            async: true, //请求是否异步，默认为异步，这也是ajax重要特性
            data: {id: node.data.id, title: $("#echoActive2").val()},    //参数值
            type: "GET",   //请求方式
            success: function (data) {
                console.log("success");
                $("#tree2").fancytree("getTree").reload();
                console.log("success2222");
            }
        });
        console.log("End");
    }


    var pagefunction = function () {

        $("#treetable").fancytree({
            extensions: ["table"],
            checkbox: true,
            table: {
                indentation: 20,      // indent 20px per node level
                nodeColumnIdx: 2,     // render the node title into the 2nd column
                checkboxColumnIdx: 0  // render the checkboxes into the 1st column
            },
            source: {
                url: "/system/org/list",
                cache: false
            },
            renderColumns: function (event, data) {
                var node = data.node,
                        $tdList = $(node.tr).find(">td");
                // (index #0 is rendered by fancytree by adding the checkbox)
                $tdList.eq(1).text(node.getIndexHier()).addClass("alignRight");
                // (index #2 is rendered by fancytree)
                $tdList.eq(3).text(node.data.contactName);
                $tdList.eq(4).text(node.data.contactTel);

//                $tdList.eq(4).html("<input type='checkbox' name='like' value='" + node.key + "'>");
            },
            // --- Node events -------------------------------------------------
            activate: function (event, data) {
                var node = data.node;
                // acces node attributes
                $("#nowid").text(node.title);
                if (!$.isEmptyObject(node.data)) {
//          alert("custom node data: " + JSON.stringify(node.data));
                    console.log(node.data);
                    console.log(node.title);
                    console.log(node.data.id);

                    console.log(node.key);


                }
            }
        });


        $("#btnNew").click(function () {

            console.log("realCreateOrg");
            var node = $("#treetable").fancytree("getActiveNode");
            if (node == null || node == undefined || node == '') {
                console.log("请先选择一个节点")

            } else {
                $("#realeditdiv").load("/system/org/new?pid=" + node.data.id + "&pname=" + encodeURIComponent(node.title));

                if ($("#real_entity").hasClass("jarviswidget-collapsed"))
                    $("#real_entity a.jarviswidget-toggle-btn").trigger("click");
            }

        });

        $("#btnSubNew").click(function () {

            console.log("realCreateSubOrg");
            var node = $("#treetable").fancytree("getActiveNode");
            if (node == null || node == undefined || node == '') {
                console.log("请先选择一个节点")

            } else {
                $("#realeditdiv").load("/system/org/new?pid=" + node.data.id + "&pname=" + encodeURIComponent(node.title));

                if ($("#real_entity").hasClass("jarviswidget-collapsed"))
                    $("#real_entity a.jarviswidget-toggle-btn").trigger("click");
            }

        });

        $("#btnModify").click(function () {

            console.log("realModifyOrg");
            var node = $("#treetable").fancytree("getActiveNode");
            if (node == null || node == undefined || node == '') {
                console.log("请先选择一个节点")

            } else {
                $("#realeditdiv").load("/system/org/show/" + node.data.id);

                if ($("#real_entity").hasClass("jarviswidget-collapsed"))
                    $("#real_entity a.jarviswidget-toggle-btn").trigger("click");
            }

        });

        /* Handle custom checkbox clicks */
        /* $("#treetable").delegate("input[name=like]", "click", function (e) {
         var node = $.ui.fancytree.getNode(e),
         $input = $(e.target);
         e.stopPropagation();  // prevent fancytree activate for this row
         if ($input.is(":checked")) {
         alert("like " + $input.val());
         } else {
         alert("dislike " + $input.val());
         }
         });*/

        // using default options

    };


    var pagedestroy = function () {

    };

    // end destroy

    // run pagefunction
    //pagefunction();

    // loadscript and run pagefunction
    loadScript("realaicy/js/fancytree/jquery.fancytree-all.js", pagefunction);

</script>
